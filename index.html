<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silas Sista Vila</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="/images/icon-192.png">
    <meta name="theme-color" content="#1a1a1a"/>
</head>
<body>
    <div id="start-screen" class="screen active"> 
	<button id="start-btn">Börja</button>
  	<button id="reset-btn" style="display:none;">Börja om</button>
    </div>
    <div id="intro-screen" class="screen"> <div class="content"> <img id="silas-image" src="images/silas.png" alt="Anden Silas"> <p id="intro-text" class="story"></p> </div> </div>
    <div id="map-screen" class="screen"> <div id="map"></div> <div id="story-banner"></div> <div id="distance-info">Väntar på din position...</div> </div>
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <p id="feedback-text"></p>
            <img id="task-image" src="" alt="Uppgiftsbild">
            <h2 id="task-title"></h2>
            <p id="task-question" class="question"></p>
            <p id="choices-prompt"></p>
            <input type="text" id="task-answer" placeholder="Skriv ditt svar här...">
            <div id="choices-container"></div>
            <button id="submit-answer-btn">Skicka svar</button>
        </div>
    </div>
    <div id="story-modal" class="modal"> <div class="modal-content"> <h2 id="story-modal-title"></h2> <img id="silas-modal-image" src="images/silas.png" alt="Anden Silas"> <p id="story-modal-text" class="story"></p> <button id="story-modal-btn">Fortsätt...</button> </div> </div>
    <div id="info-modal" class="modal"> <div class="modal-content"> <h2 id="info-modal-title"></h2> <p id="info-modal-text" class="story"></p> <button id="info-modal-btn">Okej</button> </div> </div>
    <div id="jumpscare-screen" class="screen"> <img id="jumpscare-image" src="" alt="Jump Scare"> </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJXLgPXI5L-zrNRRhXHzjNCFI96kHx1iQ&v=weekly&libraries=marker&loading=async&callback=initMap" async></script>
    <script src="app.js"></script>

<!-- Bakgrundsljud för startskärmen -->
<audio id="start-audio" src="./audio/spooky_start.mp3" loop></audio>

<script>
(function () {
  const audioEl = document.getElementById('start-audio');
  const btnEl = document.getElementById('start-btn');

  function stopAudio() {
    if (!audioEl) return;
    audioEl.pause();
    audioEl.currentTime = 0;
  }

  // Försök spela direkt när sidan laddas
  window.addEventListener('load', () => {
    if (!audioEl) return;
    audioEl.volume = 0.5;
    const p = audioEl.play();
    if (p && typeof p.then === 'function') {
      p.catch(() => {
        // Om autoplay blockeras, starta ljudet vid första användarinteraktion
        const resumeOnce = (ev) => {
          // Om första interaktionen är klick på startknappen: spela INTE upp
          if (ev && ev.target && ev.target.closest && ev.target.closest('#start-btn')) {
            document.removeEventListener('click', resumeOnce, true);
            return;
          }
          audioEl.play().catch(() => {});
          document.removeEventListener('click', resumeOnce, true);
        };
        // använd capture för att ligga före ev. bubblande handlers
        document.addEventListener('click', resumeOnce, true);
      });
    }
  });

  // Stoppa vid klick på "Börja"
  if (btnEl) {
    btnEl.addEventListener('click', stopAudio, { once: true });
  }
})();
</script>

</body>
</html>